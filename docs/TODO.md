# TODO - Syntra Trade Consultant

> **–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-11-17
> **–°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞:** –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ (Foundation)

## –£—Å–ª–æ–≤–Ω—ã–µ –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏—è
- ‚¨ú –ù–µ –Ω–∞—á–∞—Ç–æ
- üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ
- ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
- ‚è∏Ô∏è –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
- ‚ùå –û—Ç–º–µ–Ω–µ–Ω–æ

---

## –≠–¢–ê–ü 1: –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–û–ï–ö–¢–ê (Foundation)

### 1.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- üîÑ –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
  - ‚¨ú src/
  - ‚¨ú src/handlers/
  - ‚¨ú src/services/
  - ‚¨ú src/middleware/
  - ‚¨ú src/database/
  - ‚¨ú src/utils/
  - ‚¨ú config/
  - ‚¨ú tests/
  - ‚¨ú alembic/
- ‚¨ú –°–æ–∑–¥–∞—Ç—å .gitignore –¥–ª—è Python
- ‚¨ú –°–æ–∑–¥–∞—Ç—å README.md —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–µ–∫—Ç–∞

### 1.2 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚¨ú –°–æ–∑–¥–∞—Ç—å requirements.txt —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
  - aiogram==3.22.0
  - sqlalchemy[asyncio]
  - asyncpg
  - alembic
  - openai
  - pycoingecko
  - aiohttp
  - python-dotenv
  - tenacity
  - tiktoken
  - apscheduler
- ‚¨ú –°–æ–∑–¥–∞—Ç—å .env.example —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚¨ú –°–æ–∑–¥–∞—Ç—å config/config.py –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚¨ú –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (config/logging.py)

### 1.3 –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚¨ú –°–æ–∑–¥–∞—Ç—å docker-compose.yml –¥–ª—è PostgreSQL
- ‚¨ú –°–æ–∑–¥–∞—Ç—å database/models.py —Å SQLAlchemy –º–æ–¥–µ–ª—è–º–∏
  - ‚¨ú User (id, telegram_id, username, created_at, is_subscribed, last_activity)
  - ‚¨ú ChatHistory (id, user_id, role, content, timestamp, tokens_used)
  - ‚¨ú RequestLimit (id, user_id, date, count, limit)
  - ‚¨ú AdminLog (id, admin_id, action, target_user_id, timestamp, details)
  - ‚¨ú CostTracking (id, user_id, service, tokens, cost, timestamp)
- ‚¨ú –°–æ–∑–¥–∞—Ç—å database/crud.py —Å CRUD –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
- ‚¨ú –ù–∞—Å—Ç—Ä–æ–∏—Ç—å async engine –∏ session maker
- ‚¨ú –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å Alembic
- ‚¨ú –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é

---

## –≠–¢–ê–ü 2: –ë–ê–ó–û–í–´–ô TELEGRAM-–ë–û–¢

### 2.1 aiogram 3.x Setup
- ‚¨ú –°–æ–∑–¥–∞—Ç—å bot.py —Å –±–∞–∑–æ–≤–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π
- ‚¨ú –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Dispatcher –∏ Storage
- ‚¨ú –°–æ–∑–¥–∞—Ç—å —Ä–æ—É—Ç–µ—Ä—ã (handlers/__init__.py)
- ‚¨ú –î–æ–±–∞–≤–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π error handler

### 2.2 Handlers
- ‚¨ú handlers/start.py
  - ‚¨ú –ö–æ–º–∞–Ω–¥–∞ /start
  - ‚¨ú –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
  - ‚¨ú –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
- ‚¨ú handlers/help.py
  - ‚¨ú –ö–æ–º–∞–Ω–¥–∞ /help
  - ‚¨ú –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
- ‚¨ú handlers/common.py
  - ‚¨ú –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
  - ‚¨ú –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (AI)

### 2.3 Middleware
- ‚¨ú middleware/database.py - DatabaseMiddleware
  - ‚¨ú –ò–Ω–∂–µ–∫—Ü–∏—è —Å–µ—Å—Å–∏–∏ –ë–î
  - ‚¨ú –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–µ—Å—Å–∏–∏
- ‚¨ú middleware/subscription.py - SubscriptionMiddleware
  - ‚¨ú –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª
  - ‚¨ú Inline –∫–Ω–æ–ø–∫–∞ –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏
  - ‚¨ú Callback –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚¨ú middleware/request_limit.py - RequestLimitMiddleware
  - ‚¨ú –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ 5 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å
  - ‚¨ú –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç —Å—á–µ—Ç—á–∏–∫–∞
  - ‚¨ú –°–±—Ä–æ—Å –≤ 00:00 UTC
- ‚¨ú middleware/logging.py - LoggingMiddleware
  - ‚¨ú –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
  - ‚¨ú –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î

### 2.4 –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫
- ‚¨ú –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —á–µ—Ä–µ–∑ bot.get_chat_member()
- ‚¨ú –°–æ–∑–¥–∞—Ç—å inline keyboard —Å –∫–Ω–æ–ø–∫–æ–π –ø–æ–¥–ø–∏—Å–∫–∏
- ‚¨ú –û–±—Ä–∞–±–æ—Ç–∞—Ç—å callback –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏
- ‚¨ú –õ–æ–≥–∏–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏ –æ—Ç–ø–∏—Å–∫–µ
- ‚¨ú –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –≤ –ë–î

---

## –≠–¢–ê–ü 3: –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø AI (OpenAI + Together API)

### 3.1 OpenAI API Integration
- ‚¨ú –°–æ–∑–¥–∞—Ç—å services/openai_service.py
- ‚¨ú –ù–∞—Å—Ç—Ä–æ–∏—Ç—å AsyncOpenAI client
- ‚¨ú –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å streaming responses
  - ‚¨ú –ë–∞–∑–æ–≤—ã–π streaming
  - ‚¨ú –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—á–∞—Ç–∞–Ω–∏—è –≤ Telegram
  - ‚¨ú –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
- ‚¨ú –ù–∞—Å—Ç—Ä–æ–∏—Ç—å retry logic —Å exponential backoff
  - ‚¨ú –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å tenacity
  - ‚¨ú –û–±—Ä–∞–±–æ—Ç–∫–∞ RateLimitError
  - ‚¨ú –û–±—Ä–∞–±–æ—Ç–∫–∞ APIError
- ‚¨ú –†–æ—É—Ç–∏–Ω–≥ –º–æ–¥–µ–ª–µ–π
  - ‚¨ú gpt-4o –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
  - ‚¨ú gpt-4o-mini –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö
  - ‚¨ú –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
- ‚¨ú Fallback –º–µ—Ö–∞–Ω–∏–∑–º –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚¨ú –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ token usage
  - ‚¨ú –ü–æ–¥—Å—á–µ—Ç —Å tiktoken
  - ‚¨ú –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ CostTracking
  - ‚¨ú –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏

### 3.2 System Prompts –∏ –ü–µ—Ä—Å–æ–Ω–∞
- ‚¨ú –°–æ–∑–¥–∞—Ç—å docs/SYNTRA_PERSONA.md
  - ‚¨ú –û–ø–∏—Å–∞–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞ –∏ —Å—Ç–∏–ª—è
  - ‚¨ú –†–∏—Ç—É–∞–ª—ã –∏ –∫—Ä–∏–ø—Ç–æ-—Å–µ–∫—Ç–∞–Ω—Ç—Å–∫–∞—è —Å—Ç–∏–ª–∏—Å—Ç–∏–∫–∞
  - ‚¨ú –°–∞–∫—Ä–∞–ª—å–Ω—ã–π –≤–∞–π–±
  - ‚¨ú –ü—Ä–∏–º–µ—Ä—ã –¥–∏–∞–ª–æ–≥–æ–≤
- ‚¨ú –°–æ–∑–¥–∞—Ç—å config/prompts.py —Å system prompt
- ‚¨ú –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –Ω–∞ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å
- ‚¨ú A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 3.3 Context Management
- ‚¨ú –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –≤ ChatHistory
- ‚¨ú –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö N —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚¨ú –õ–∏–º–∏—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (10 —Å–æ–æ–±—â–µ–Ω–∏–π)
- ‚¨ú –°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤
- ‚¨ú –ö–æ–º–∞–Ω–¥–∞ /clear –¥–ª—è –æ—á–∏—Å—Ç–∫–∏

### 3.4 Together API (Vision)
- ‚¨ú –ò–∑—É—á–∏—Ç—å Together API docs (–ø–æ–ª—É—á–∏—Ç—å –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- ‚¨ú –°–æ–∑–¥–∞—Ç—å services/together_service.py
- ‚¨ú –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Qwen 2.5 VL –º–æ–¥–µ–ª—å
- ‚¨ú –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ retry

---

## –≠–¢–ê–ü 4: VISION-–ü–ê–ô–ü–õ–ê–ô–ù

### 4.1 Photo Processing
- ‚¨ú –°–æ–∑–¥–∞—Ç—å handlers/vision.py
- ‚¨ú –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ñ–æ—Ç–æ (F.photo)
- ‚¨ú –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–æ—Ç–æ (bot.download_file)
- ‚¨ú –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ base64
- ‚¨ú –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Together API

### 4.2 Technical Analysis –∏–∑ –≥—Ä–∞—Ñ–∏–∫–∞
- ‚¨ú –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ –æ—Ç Vision –º–æ–¥–µ–ª–∏
- ‚¨ú –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
  - ‚¨ú –°–≤–µ—á–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
  - ‚¨ú –¢—Ä–µ–Ω–¥—ã
  - ‚¨ú –£—Ä–æ–≤–Ω–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏/—Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è
- ‚¨ú –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞
- ‚¨ú –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## –≠–¢–ê–ü 5: –ö–†–ò–ü–¢–û–ê–ù–ê–õ–ò–¢–ò–ö–ê

### 5.1 CoinGecko Integration
- ‚¨ú –°–æ–∑–¥–∞—Ç—å services/coingecko_service.py
- ‚¨ú –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å pycoingecko
- ‚¨ú –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω
  - ‚¨ú –û–¥–Ω–∞ –º–æ–Ω–µ—Ç–∞
  - ‚¨ú –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –º–æ–Ω–µ—Ç
  - ‚¨ú –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (mcap, vol, change)
- ‚¨ú –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (OHLC)
- ‚¨ú Market data (—Ç–æ–ø –º–æ–Ω–µ—Ç)
- ‚¨ú –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å TTL 60 —Å–µ–∫
  - ‚¨ú –°–æ–∑–¥–∞—Ç—å utils/cache.py
  - ‚¨ú In-memory cache
  - ‚¨ú Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è prod)
- ‚¨ú –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API

### 5.2 Technical Analysis
- ‚¨ú –°–æ–∑–¥–∞—Ç—å services/technical_analysis.py
- ‚¨ú –†–∞—Å—á–µ—Ç —É—Ä–æ–≤–Ω–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏/—Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è
- ‚¨ú –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤ (MA, EMA)
- ‚¨ú –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–µ–Ω–æ–≤—ã—Ö –∫–∞–Ω–∞–ª–æ–≤
- ‚¨ú –°–≤–µ—á–Ω–æ–π –∞–Ω–∞–ª–∏–∑ (–ø–∞—Ç—Ç–µ—Ä–Ω—ã)
- ‚¨ú –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (RSI, MACD - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 5.3 Trading Recommendations
- ‚¨ú –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ TA
- ‚¨ú –£—Ä–æ–≤–Ω–∏ –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞
- ‚¨ú Stop-loss –∏ Take-profit
- ‚¨ú Disclaimer –æ —Ä–∏—Å–∫–∞—Ö

### 5.4 Crypto Handlers
- ‚¨ú –°–æ–∑–¥–∞—Ç—å handlers/crypto.py
- ‚¨ú –ö–æ–º–∞–Ω–¥–∞ /price <coin>
- ‚¨ú –ö–æ–º–∞–Ω–¥–∞ /analyze <coin>
- ‚¨ú –ö–æ–º–∞–Ω–¥–∞ /market (—Ç–æ–ø –º–æ–Ω–µ—Ç)
- ‚¨ú –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AI –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

---

## –≠–¢–ê–ü 6: –ù–û–í–û–°–¢–ù–û–ô –§–û–ù

### 6.1 CryptoPanic Integration
- ‚¨ú –°–æ–∑–¥–∞—Ç—å services/cryptopanic_service.py
- ‚¨ú API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π
- ‚¨ú –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –º–æ–Ω–µ—Ç–∞–º
- ‚¨ú –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ relevance –∏ sentiment
- ‚¨ú –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### 6.2 News Processing
- ‚¨ú –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–µ–π (5 –º–∏–Ω)
- ‚¨ú –ü–æ–¥–±–æ—Ä 2-3 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
- ‚¨ú –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–π–¥–∂–µ—Å—Ç–∞
- ‚¨ú –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AI –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

### 6.3 Scheduler
- ‚¨ú –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å APScheduler
- ‚¨ú –°–æ–∑–¥–∞—Ç—å services/scheduler_service.py
- ‚¨ú Cron job –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π
- ‚¨ú Event tracking (–ª–∏—Å—Ç–∏–Ω–≥–∏, –∞–ø–≥—Ä–µ–π–¥—ã)

---

## –≠–¢–ê–ü 7: –õ–ò–ú–ò–¢–´ –ò –ö–û–ù–¢–†–û–õ–¨

### 7.1 Request Limits
- ‚¨ú RequestLimitMiddleware (—É–∂–µ –≤ –≠—Ç–∞–ø–µ 2)
- ‚¨ú –ö–æ–º–∞–Ω–¥–∞ /limits (–ø–æ–∫–∞–∑–∞—Ç—å –æ—Å—Ç–∞—Ç–æ–∫)
- ‚¨ú –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞
- ‚¨ú –ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ (00:00 UTC)

### 7.2 Subscription Control
- ‚¨ú –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º AI-–∑–∞–ø—Ä–æ—Å–æ–º
- ‚¨ú Webhook –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—Ç–ø–∏—Å–æ–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚¨ú Polling check —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–ø–∏—Å–∫–∏
- ‚¨ú –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –æ—Ç–ø–∏—Å–∫–µ
- ‚¨ú –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ AdminLog

### 7.3 Cost Monitoring
- ‚¨ú –ü–æ–¥—Å—á–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤ OpenAI (tiktoken)
- ‚¨ú –ü–æ–¥—Å—á–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ Together API
- ‚¨ú –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚¨ú –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –±—é–¥–∂–µ—Ç–∞
- ‚¨ú –ö–æ–º–∞–Ω–¥–∞ /admin_costs –¥–ª—è –∞–¥–º–∏–Ω–∞

---

## –≠–¢–ê–ü 8: –í–û–†–û–ù–ö–ê –£–î–ï–†–ñ–ê–ù–ò–Ø

### 8.1 Scheduler Setup
- ‚¨ú APScheduler (—É–∂–µ –≤ –≠—Ç–∞–ø–µ 6)
- ‚¨ú –ó–∞–¥–∞—á–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é

### 8.2 –î–æ–∂–∏–º–Ω—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏
- ‚¨ú –°–æ–∑–¥–∞—Ç—å services/retention_service.py
- ‚¨ú –†–∞—Å—Å—ã–ª–∫–∞ —á–µ—Ä–µ–∑ 1 —á–∞—Å –¥–ª—è –Ω–µ –ø–æ–¥–ø–∏—Å–∞–≤—à–∏—Ö—Å—è
- ‚¨ú –†–∞—Å—Å—ã–ª–∫–∞ —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞
- ‚¨ú –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚¨ú –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏

### 8.3 –†–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è
- ‚¨ú –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ last_activity –≤ User
- ‚¨ú –ó–∞–¥–∞—á–∞ –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö 7+ –¥–Ω–µ–π
- ‚¨ú –ú—è–≥–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –æ—Ç–ø–∏—Å–∫–µ
- ‚¨ú A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π

---

## –≠–¢–ê–ü 9: –ê–î–ú–ò–ù-–§–£–ù–ö–¶–ò–ò

### 9.1 –ê–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥—ã
- ‚¨ú –°–æ–∑–¥–∞—Ç—å handlers/admin.py
- ‚¨ú Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∞
- ‚¨ú –ö–æ–º–∞–Ω–¥–∞ /admin_stats
  - ‚¨ú –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–≤—Å–µ–≥–æ —é–∑–µ—Ä–æ–≤, –∞–∫—Ç–∏–≤–Ω—ã—Ö, –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö)
  - ‚¨ú –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥
- ‚¨ú –ö–æ–º–∞–Ω–¥–∞ /admin_users
  - ‚¨ú –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - ‚¨ú –ü–æ–∏—Å–∫ –ø–æ telegram_id/username
  - ‚¨ú –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚¨ú –ö–æ–º–∞–Ω–¥–∞ /admin_limits
  - ‚¨ú –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞–º–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —é–∑–µ—Ä–∞
  - ‚¨ú –°–±—Ä–æ—Å –ª–∏–º–∏—Ç–æ–≤
  - ‚¨ú –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤
- ‚¨ú –ö–æ–º–∞–Ω–¥–∞ /admin_costs
  - ‚¨ú –†–∞—Å—Ö–æ–¥—ã –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º (OpenAI, Together)
  - ‚¨ú –†–∞—Å—Ö–æ–¥—ã –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
  - ‚¨ú –û–±—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã –∑–∞ –ø–µ—Ä–∏–æ–¥

### 9.2 Admin Panel (Telegram Bot)
- ‚¨ú Inline keyboard –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- ‚¨ú –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫
- ‚¨ú –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ CSV
- ‚¨ú –ì—Ä–∞—Ñ–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (matplotlib/plotly)

### 9.3 Logging & Analytics
- ‚¨ú –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ AdminLog
- ‚¨ú –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–æ–∫–µ–Ω–∞–º –≤ CostTracking
- ‚¨ú –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã/–∫–æ–º–∞–Ω–¥—ã
- ‚¨ú –ö–æ–Ω–≤–µ—Ä—Å–∏–æ–Ω–Ω–∞—è –≤–æ—Ä–æ–Ω–∫–∞
- ‚¨ú Retention metrics

### 9.4 Alerts System
- ‚¨ú –°–æ–∑–¥–∞—Ç—å services/alerts_service.py
- ‚¨ú Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –∞–¥–º–∏–Ω–∞
- ‚¨ú –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –±—é–¥–∂–µ—Ç–∞
- ‚¨ú –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö API
- ‚¨ú –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ —Ä–µ–∑–∫–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

---

## –≠–¢–ê–ü 10: –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –ò –î–ï–ü–õ–û–ô

### 10.1 Performance
- ‚¨ú –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ (cProfile, line_profiler)
- ‚¨ú –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚¨ú Connection pooling –¥–ª—è –ë–î
- ‚¨ú Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è (prod)

### 10.2 Testing
- ‚¨ú –ù–∞—Å—Ç—Ä–æ–∏—Ç—å pytest
- ‚¨ú Unit —Ç–µ—Å—Ç—ã –¥–ª—è services
- ‚¨ú Integration —Ç–µ—Å—Ç—ã –¥–ª—è handlers
- ‚¨ú –ú–æ–∫-—Ç–µ—Å—Ç—ã –¥–ª—è API
- ‚¨ú Coverage > 70%

### 10.3 Deployment
- ‚¨ú –°–æ–∑–¥–∞—Ç—å Dockerfile
- ‚¨ú –û–±–Ω–æ–≤–∏—Ç—å docker-compose –¥–ª—è prod
- ‚¨ú CI/CD pipeline (GitHub Actions)
- ‚¨ú –î–µ–ø–ª–æ–π –Ω–∞ VPS
- ‚¨ú Systemd service –∏–ª–∏ Docker –≤ prod

### 10.4 Monitoring
- ‚¨ú Health check endpoint
- ‚¨ú Prometheus metrics (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚¨ú Grafana dashboards (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚¨ú Error tracking (Sentry)

---

## –ë–´–°–¢–†–´–ô –î–û–°–¢–£–ü –ö –¢–ï–ö–£–©–ò–ú –ó–ê–î–ê–ß–ê–ú

### –°–µ–π—á–∞—Å –≤ —Ä–∞–±–æ—Ç–µ:
1. üîÑ –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
2. ‚¨ú –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞
3. ‚¨ú –°–æ–∑–¥–∞–Ω–∏–µ requirements.txt

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1. –ó–∞–≤–µ—Ä—à–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
2. –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
4. –ü–æ–¥–Ω—è—Ç—å PostgreSQL —á–µ—Ä–µ–∑ docker-compose
5. –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª–∏ –ë–î –∏ –º–∏–≥—Ä–∞—Ü–∏–∏

---

## –¢–†–ï–ö–ò–ù–ì –í–†–ï–ú–ï–ù–ò –ò –°–¢–û–ò–ú–û–°–¢–ò (–∏–∑ –¢–ó)

| –≠—Ç–∞–ø | –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ | –û—Ü–µ–Ω–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ |
|------|----------------|------------------|
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π (OpenAI) | 6-8 —á–∞—Å–æ–≤ | 15k |
| Vision-–ø–∞–π–ø–ª–∞–π–Ω (Together) | 6-8 —á–∞—Å–æ–≤ | 10k |
| –¶–µ–Ω—ã, TA, –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ | 6-10 —á–∞—Å–æ–≤ | 10k |
| –ù–æ–≤–æ—Å—Ç–Ω–æ–π —Ñ–æ–Ω | 5-10 —á–∞—Å–æ–≤ | 10k |
| –ü–µ—Ä—Å–æ–Ω–∞ –±–æ—Ç–∞ | 3-5 —á–∞—Å–æ–≤ | 5k |
| –ê–¥–º–∏–Ω-—Ñ—É–Ω–∫—Ü–∏–∏ | 5-10 —á–∞—Å–æ–≤ | 15k |
| **–ò–¢–û–ì–û** | **31-51 —á–∞—Å** | **65k** |

---

## –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø

- –î–æ–∫—É–º–µ–Ω—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Å–µ—Å—Å–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–∏—Å–∫ (Cmd+F / Ctrl+F) –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞–¥–∞—á–∞–º
- –û—Ç–º–µ—á–∞–π—Ç–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –∫–∞–∫ ‚úÖ
- –î–æ–±–∞–≤–ª—è–π—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –∑–∞–¥–∞—á–∞–º –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
