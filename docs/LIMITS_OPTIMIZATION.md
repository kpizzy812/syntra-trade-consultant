# üéØ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ª–∏–º–∏—Ç–æ–≤ –∏ —ç–∫–æ–Ω–æ–º–∏–∫–∏ Syntra

**–î–∞—Ç–∞:** 2025-01-25
**–°—Ç–∞—Ç—É—Å:** Implemented
**–¶–µ–ª—å:** –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏ 40-50% –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

---

## üìä –ü—Ä–æ–±–ª–µ–º–∞ (–¥–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)

### –¢–µ–∫—É—â–∏–µ –ª–∏–º–∏—Ç—ã –£–ë–´–¢–û–ß–ù–´:

```
FREE: 5 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å √ó 30 = 150/–º–µ—Å
–°—Ç–æ–∏–º–æ—Å—Ç—å: 150 √ó $0.01 = $1.50/–º–µ—Å
–í—ã—Ä—É—á–∫–∞: $0
–ú–∞—Ä–∂–∞: -$1.50 (-100% —É–±—ã—Ç–æ–∫!)

BASIC ($4.99/–º–µ—Å): 20/–¥–µ–Ω—å = 600/–º–µ—Å
–°—Ç–æ–∏–º–æ—Å—Ç—å: $6.00/–º–µ—Å
–ú–∞—Ä–∂–∞: -$1.01 (-20% —É–±—ã—Ç–æ–∫!)

PREMIUM ($24.99/–º–µ—Å): 100/–¥–µ–Ω—å = 3000/–º–µ—Å
–°—Ç–æ–∏–º–æ—Å—Ç—å: $30.00/–º–µ—Å
–ú–∞—Ä–∂–∞: -$5.01 (-20% —É–±—ã—Ç–æ–∫!)
```

### –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–±–∏–≤–∞–µ—Ç –≤—Å—ë:
- –ù–æ–≤–∏—á–æ–∫: +15 –∑–∞–ø—Ä–æ—Å–æ–≤ = **$0.15** —É–±—ã—Ç–æ–∫
- –†–µ—Ñ–µ—Ä–µ—Ä: +30 –∑–∞–ø—Ä–æ—Å–æ–≤ = **$0.30** —É–±—ã—Ç–æ–∫
- **–ò—Ç–æ–≥–æ: $0.45 —É–±—ã—Ç–∫–∞** –Ω–∞ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–≤–µ–¥—ë–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- Gold tier (+150/–º–µ—Å): **$1.50 —É–±—ã—Ç–∫–∞/–º–µ—Å**
- Platinum (+500/–º–µ—Å): **$5.00 —É–±—ã—Ç–∫–∞/–º–µ—Å**

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: –ñ–µ—Å—Ç–∫–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è

### 1. –ù–æ–≤—ã–µ –ª–∏–º–∏—Ç—ã

| Tier | Text/–¥–µ–Ω—å | Charts/–¥–µ–Ω—å | Vision/–¥–µ–Ω—å | –¶–µ–Ω–∞/–º–µ—Å |
|------|-----------|-------------|-------------|----------|
| **FREE** | 1 | 1 | 0 | $0 |
| **BASIC** | 10 | 3 | 2 | $9.99 |
| **PREMIUM** | 30 | 10 | 10 | $24.99 |
| **VIP** | 100 | 30 | 30 | $49.99 |

### 2. 7-Day Premium Trial (–≤–º–µ—Å—Ç–æ —Ö–∞–ª—è–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)

**–î–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
- ‚úÖ 7 –¥–Ω–µ–π –ø–æ–ª–Ω–æ–≥–æ Premium –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ 30 —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö + 10 –≥—Ä–∞—Ñ–∏–∫–æ–≤ + 10 vision/–¥–µ–Ω—å
- ‚úÖ –í—Å–µ killer features
- ‚úÖ –ü–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è –æ—Ü–µ–Ω–∫–∏

**–ü–æ—Å–ª–µ trial:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π downgrade –Ω–∞ FREE (1 –∑–∞–ø—Ä–æ—Å/–¥–µ–Ω—å)
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞ 24—á –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è
- **-20% —Å–∫–∏–¥–∫–∞** –Ω–∞ –ø–µ—Ä–≤—É—é –ø–æ–∫—É–ø–∫—É (48 —á–∞—Å–æ–≤)
- Push –≤ Telegram ‚Üí –∫–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç Mini App checkout

### 3. –£—Ä–µ–∑–∞–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è FREE

**FREE tier –ø–æ–ª—É—á–∞–µ—Ç:**
- ‚úÖ –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ –º–æ–Ω–µ—Ç—ã
- ‚úÖ –ë–∞–∑–æ–≤—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (RSI, MACD, EMA)
- ‚úÖ –ö—Ä–∏–ø—Ç–æ –Ω–æ–≤–æ—Å—Ç–∏
- ‚úÖ Fear & Greed Index
- ‚úÖ 1 –≥—Ä–∞—Ñ–∏–∫/–¥–µ–Ω—å

**FREE –ù–ï –ø–æ–ª—É—á–∞–µ—Ç:**
- ‚ùå Candlestick patterns (—Å–≤–µ—á–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã)
- ‚ùå On-chain –º–µ—Ç—Ä–∏–∫–∏ (CoinMetrics)
- ‚ùå Funding rates, long/short ratio
- ‚ùå Liquidation history
- ‚ùå Cycle analysis (—Ä—ã–Ω–æ—á–Ω—ã–µ —Ü–∏–∫–ª—ã)
- ‚ùå Deep indicators (OBV, ATR, Bollinger Bands)
- ‚ùå Vision –∞–Ω–∞–ª–∏–∑ (0 —Ñ–æ—Ç–æ–∫)

### 4. –ú–æ–¥–µ–ª—å —Ä–æ—É—Ç–∏–Ω–≥ –ø–æ tier

```python
FREE:  4o-mini + DeepSeek (2-step —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π)
BASIC: 4o-mini + DeepSeek (2-step –ø–æ–ª–Ω—ã–π)
PREMIUM: 4o-mini + GPT-4o (—É–º–Ω—ã–π —Ä–æ—É—Ç–∏–Ω–≥)
VIP: 4o-mini + GPT-4o (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
```

### 5. –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ (—É—Ä–µ–∑–∞–Ω–∞ –≤ 3 —Ä–∞–∑–∞)

**–í–º–µ—Å—Ç–æ:**
- –ù–æ–≤–∏—á–æ–∫: ~~+15~~ ‚Üí **+5 –∑–∞–ø—Ä–æ—Å–æ–≤** (—Ä–∞–∑–æ–≤–æ)
- –†–µ—Ñ–µ—Ä–µ—Ä: ~~+30~~ ‚Üí **+10 –∑–∞–ø—Ä–æ—Å–æ–≤** (–ø–æ—Å–ª–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏)

**–¢–∏—Ä—ã:**
- Silver (5-14): ~~+50~~ ‚Üí **+20 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–µ—Å**
- Gold (15-49): ~~+150~~ ‚Üí **+50 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–µ—Å**
- Platinum (50+): ~~+500~~ ‚Üí **+100 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–µ—Å**

---

## üí∞ –ù–æ–≤–∞—è —ç–∫–æ–Ω–æ–º–∏–∫–∞ (PROFITABLE!)

### FREE Tier
```
–¢–µ–∫—Å—Ç: 1 –∑–∞–ø—Ä–æ—Å/–¥–µ–Ω—å √ó 30 = 30/–º–µ—Å
–°—Ç–æ–∏–º–æ—Å—Ç—å: 30 √ó $0.003 = $0.09/–º–µ—Å
–í—ã—Ä—É—á–∫–∞: $0
–ú–∞—Ä–∂–∞: -$0.09 (—Ü–µ–ª—å: –∫–æ–Ω–≤–µ—Ä—Å–∏—è –≤ Premium)
```

### BASIC ($9.99/–º–µ—Å)
```
100% usage:
- –¢–µ–∫—Å—Ç: 10/–¥–µ–Ω—å √ó 30 = 300/–º–µ—Å √ó $0.005 = $1.50
- Charts: 3/–¥–µ–Ω—å √ó 30 = 90 √ó $0.002 = $0.18
- Vision: 2/–¥–µ–Ω—å √ó 30 = 60 √ó $0.020 = $1.20
–ò—Ç–æ–≥–æ —Å—Ç–æ–∏–º–æ—Å—Ç—å: $2.88/–º–µ—Å
–í—ã—Ä—É—á–∫–∞: $9.99/–º–µ—Å
–ü—Ä–∏–±—ã–ª—å: $7.11/–º–µ—Å
–ú–∞—Ä–∂–∞: 71% ‚úÖ

50% usage:
–°—Ç–æ–∏–º–æ—Å—Ç—å: $1.44/–º–µ—Å
–ü—Ä–∏–±—ã–ª—å: $8.55/–º–µ—Å
–ú–∞—Ä–∂–∞: 86% ‚úÖ‚úÖ
```

### PREMIUM ($24.99/–º–µ—Å)
```
100% usage:
- –¢–µ–∫—Å—Ç: 30/–¥–µ–Ω—å √ó 30 = 900/–º–µ—Å √ó $0.015 = $13.50
- Charts: 10/–¥–µ–Ω—å √ó 30 = 300 √ó $0.002 = $0.60
- Vision: 10/–¥–µ–Ω—å √ó 30 = 300 √ó $0.020 = $6.00
–ò—Ç–æ–≥–æ —Å—Ç–æ–∏–º–æ—Å—Ç—å: $20.10/–º–µ—Å
–í—ã—Ä—É—á–∫–∞: $24.99/–º–µ—Å
–ü—Ä–∏–±—ã–ª—å: $4.89/–º–µ—Å
–ú–∞—Ä–∂–∞: 20% ‚ö†Ô∏è (–ø—Ä–∏–µ–º–ª–µ–º–æ –¥–ª—è Premium)

50% usage:
–°—Ç–æ–∏–º–æ—Å—Ç—å: $10.05/–º–µ—Å
–ü—Ä–∏–±—ã–ª—å: $14.94/–º–µ—Å
–ú–∞—Ä–∂–∞: 60% ‚úÖ
```

### VIP ($49.99/–º–µ—Å)
```
100% usage:
- –¢–µ–∫—Å—Ç: 100/–¥–µ–Ω—å √ó 30 = 3000/–º–µ—Å √ó $0.015 = $45.00
- Charts: 30/–¥–µ–Ω—å √ó 30 = 900 √ó $0.002 = $1.80
- Vision: 30/–¥–µ–Ω—å √ó 30 = 900 √ó $0.020 = $18.00
–ò—Ç–æ–≥–æ —Å—Ç–æ–∏–º–æ—Å—Ç—å: $64.80/–º–µ—Å
–í—ã—Ä—É—á–∫–∞: $49.99/–º–µ—Å
–ü—Ä–∏–±—ã–ª—å: -$14.81/–º–µ—Å
–ú–∞—Ä–∂–∞: -30% ‚ùå (–£–ë–´–¢–û–ö –ø—Ä–∏ 100% usage!)

50% usage:
–°—Ç–æ–∏–º–æ—Å—Ç—å: $32.40/–º–µ—Å
–ü—Ä–∏–±—ã–ª—å: $17.59/–º–µ—Å
–ú–∞—Ä–∂–∞: 35% ‚úÖ
```

**–í—ã–≤–æ–¥—ã:**
- BASIC: **–ø—Ä–∏–±—ã–ª—å–Ω—ã–π** –¥–∞–∂–µ –ø—Ä–∏ 100% usage (71% –º–∞—Ä–∂–∞)
- PREMIUM: **–ø—Ä–∏–±—ã–ª—å–Ω—ã–π** –ø—Ä–∏ 100% usage (20% –º–∞—Ä–∂–∞), –ø—Ä–∏ 50% usage –æ—Ç–ª–∏—á–Ω—ã–π (60%)
- VIP: **–ø—Ä–∏–±—ã–ª—å–Ω—ã–π** —Ç–æ–ª—å–∫–æ –ø—Ä–∏ usage < 80% (—Ü–µ–ª–µ–≤–æ–π —Å–µ–≥–º–µ–Ω—Ç: 30-50% usage)

---

## üéØ –¶–µ–ª–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### –ö–æ–Ω–≤–µ—Ä—Å–∏—è:
```
Trial ‚Üí Paid: 15-25% (–∏–Ω–¥—É—Å—Ç—Ä–∏—è: 10-20%)
FREE ‚Üí BASIC: 3-5%
BASIC ‚Üí PREMIUM: 10-15%
PREMIUM ‚Üí VIP: 5-10%
```

### –°—Ä–µ–¥–Ω–∏–π —á–µ–∫:
```
Target ARPU: $15-20/user/month
```

### Unit Economics:
```
LTV (Lifetime Value): $180-360 (12-24 –º–µ—Å—è—Ü–∞)
CAC (Cost per Acquisition): $5-15 (–æ—Ä–≥–∞–Ω–∏–∫–∞ + —Ä–µ—Ñ–µ—Ä–∞–ª—ã)
LTV/CAC ratio: > 12x (–æ—Ç–ª–∏—á–Ω–æ)
```

### –ß—ë—Ä–Ω:
```
Target churn: < 5%/month (Premium/VIP)
Target churn: < 15%/month (BASIC)
```

---

## üöÄ Trial —Å—Ç—Ä–∞—Ç–µ–≥–∏—è (–∫–æ–Ω–≤–µ—Ä—Å–∏—è 15-25%)

### Onboarding (–î–µ–Ω—å 1):
```
"üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Syntra!

–£ —Ç–µ–±—è 7 –¥–Ω–µ–π PREMIUM –±–µ—Å–ø–ª–∞—Ç–Ω–æ:
‚úÖ 30 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å
‚úÖ –ü–æ–ª–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
‚úÖ –°–≤–µ—á–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã + –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
‚úÖ On-chain –º–µ—Ç—Ä–∏–∫–∏
‚úÖ 10 –≥—Ä–∞—Ñ–∏–∫–æ–≤ + 10 vision/–¥–µ–Ω—å

–ü–æ–ø—Ä–æ–±—É–π –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å! üëá
[üìà –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å BTC]
```

### Day 7 (–∑–∞ 24—á –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è):
```
"‚è∞ –¢–≤–æ–π Premium trial –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞!

–ó–∞ 7 –¥–Ω–µ–π —Ç—ã –ø–æ–ª—É—á–∏–ª:
‚Ä¢ {total_requests} –≥–ª—É–±–æ–∫–∏—Ö –∞–Ω–∞–ª–∏–∑–æ–≤
‚Ä¢ {charts_used} –≥—Ä–∞—Ñ–∏–∫–æ–≤ —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏
‚Ä¢ {vision_used} –∞–Ω–∞–ª–∏–∑–æ–≤ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤

–ü—Ä–æ–¥–æ–ª–∂–∏ —Å Premium –∏ –ø–æ–ª—É—á–∏:
‚úÖ 30 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å (–≤–º–µ—Å—Ç–æ 1)
‚úÖ –ü–æ–ª–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
‚úÖ Killer features

üéÅ –°–ü–ï–¶–ò–ê–õ–¨–ù–û –î–õ–Ø –¢–ï–ë–Ø: -20% –Ω–∞ –ø–µ—Ä–≤—ã–π –º–µ—Å—è—Ü
$19.99 –≤–º–µ—Å—Ç–æ $24.99

[üî• –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å–æ —Å–∫–∏–¥–∫–æ–π] <- Mini App
[‚è∞ –ù–∞–ø–æ–º–Ω–∏—Ç—å –∑–∞–≤—Ç—Ä–∞]
```

### Day 8 (–ø–æ—Å–ª–µ downgrade):
```
"üòî –¢–≤–æ–π Premium trial –∑–∞–∫–æ–Ω—á–∏–ª—Å—è

–¢–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–æ:
‚Ä¢ 1 –∑–∞–ø—Ä–æ—Å/–¥–µ–Ω—å (–±–∞–∑–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑)
‚Ä¢ –ë–µ–∑ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –∏ vision
‚Ä¢ –ë–µ–∑ killer features

üéÅ –ü–û–°–õ–ï–î–ù–ò–ô –®–ê–ù–°: -20% –µ—â—ë 48 —á–∞—Å–æ–≤!

[üíé –í–µ—Ä–Ω—É—Ç—å Premium]
[üíµ –ù–∞—á–∞—Ç—å —Å BASIC ($9.99)]
```

---

## üì± Post-Trial Flow

### Day 7 notification:
1. –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
2. Highlight killer features, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª
3. –ö–Ω–æ–ø–∫–∞ ‚Üí Mini App —Å pre-filled checkout (Premium -20%)
4. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: "–ù–∞–ø–æ–º–Ω–∏—Ç—å –∑–∞–≤—Ç—Ä–∞"

### Day 8 notification:
1. –°–æ–æ–±—â–µ–Ω–∏–µ –æ downgrade
2. –ü–æ–∫–∞–∑–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è FREE tier
3. –ö–Ω–æ–ø–∫–∞ ‚Üí Mini App (Premium -20% –∏–ª–∏ BASIC)
4. Urgency: "48 —á–∞—Å–æ–≤ –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å–∫–∏–¥–∫–∏"

### Day 10 (–ø–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–Ω—Å):
```
"‚ö†Ô∏è –°–∫–∏–¥–∫–∞ -20% –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 2 —á–∞—Å–∞!

–ü–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–Ω—Å –≤–µ—Ä–Ω—É—Ç—å:
‚úÖ 30 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å
‚úÖ Killer features
‚úÖ –ì—Ä–∞—Ñ–∏–∫–∏ + vision

$19.99/–º–µ—Å –≤–º–µ—Å—Ç–æ $24.99

[‚ö° –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å]
```

---

## üõ†Ô∏è –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. Database Changes

```python
# src/database/models.py

class RequestLimit(Base):
    # –î–æ–±–∞–≤–∏—Ç—å —Ç–∏–ø—ã –∑–∞–ø—Ä–æ—Å–æ–≤
    request_type: Mapped[str] = mapped_column(
        String(20),
        default="text",
        nullable=False,
        comment="Request type: text, chart, vision"
    )

    # –û—Ç–¥–µ–ª—å–Ω—ã–µ —Å—á–µ—Ç—á–∏–∫–∏
    text_count: Mapped[int] = mapped_column(Integer, default=0)
    chart_count: Mapped[int] = mapped_column(Integer, default=0)
    vision_count: Mapped[int] = mapped_column(Integer, default=0)

class Subscription(Base):
    # Trial tracking
    is_trial: Mapped[bool] = mapped_column(Boolean, default=False)
    trial_started_at: Mapped[Optional[datetime]]
    trial_ends_at: Mapped[Optional[datetime]]

    # Post-trial discount
    has_post_trial_discount: Mapped[bool] = mapped_column(Boolean, default=False)
    discount_expires_at: Mapped[Optional[datetime]]
```

### 2. Trial Logic

```python
# src/services/trial_service.py

async def activate_trial_for_new_user(user_id: int):
    """Activate 7-day Premium trial for new user"""
    trial_ends = datetime.now(UTC) + timedelta(days=7)
    discount_expires = trial_ends + timedelta(hours=48)

    subscription = await create_subscription(
        user_id=user_id,
        tier=SubscriptionTier.PREMIUM,
        is_trial=True,
        trial_ends_at=trial_ends,
        has_post_trial_discount=True,
        discount_expires_at=discount_expires,
    )

    return subscription

async def check_trial_expiration():
    """Cron job: check trials ending in 24h"""
    trials = await get_expiring_trials(hours=24)

    for trial in trials:
        await send_trial_ending_notification(trial.user_id)

async def downgrade_expired_trials():
    """Cron job: downgrade expired trials to FREE"""
    expired = await get_expired_trials()

    for trial in expired:
        await downgrade_subscription(trial.user_id, tier=SubscriptionTier.FREE)
        await send_trial_ended_notification(trial.user_id)
```

### 3. Feature Gating

```python
# src/utils/feature_flags.py

from config.limits import has_feature, get_tier_limits

def get_available_tools(tier: SubscriptionTier) -> List[str]:
    """Get list of AI tools available for tier"""
    base_tools = ["get_crypto_price", "get_crypto_news", "get_market_overview"]

    if has_feature(tier, "candlestick_patterns"):
        base_tools.append("get_candlestick_patterns")

    if has_feature(tier, "onchain_metrics"):
        base_tools.append("get_onchain_metrics")

    if has_feature(tier, "funding_rates"):
        base_tools.append("get_funding_rates")

    return base_tools
```

---

## üìà –ü—Ä–æ–≥–Ω–æ–∑ (–ø—Ä–∏ 1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

### Scenario 1: –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π (10% –∫–æ–Ω–≤–µ—Ä—Å–∏—è)
```
FREE: 700 users √ó $0 = $0 (cost: $63/mo)
BASIC: 200 users √ó $9.99 = $1,998/mo (cost: $576/mo)
PREMIUM: 80 users √ó $24.99 = $1,999/mo (cost: $1,608/mo)
VIP: 20 users √ó $49.99 = $1,000/mo (cost: $648/mo)

Total revenue: $4,997/mo
Total cost: $2,895/mo
Profit: $2,102/mo
Margin: 42% ‚úÖ
```

### Scenario 2: –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π (20% –∫–æ–Ω–≤–µ—Ä—Å–∏—è)
```
FREE: 500 users √ó $0 = $0 (cost: $45/mo)
BASIC: 300 users √ó $9.99 = $2,997/mo (cost: $864/mo)
PREMIUM: 150 users √ó $24.99 = $3,749/mo (cost: $3,015/mo)
VIP: 50 users √ó $49.99 = $2,500/mo (cost: $1,620/mo)

Total revenue: $9,246/mo
Total cost: $5,544/mo
Profit: $3,702/mo
Margin: 40% ‚úÖ
```

### Scenario 3: –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–π (30% –∫–æ–Ω–≤–µ—Ä—Å–∏—è)
```
FREE: 300 users √ó $0 = $0 (cost: $27/mo)
BASIC: 400 users √ó $9.99 = $3,996/mo (cost: $1,152/mo)
PREMIUM: 200 users √ó $24.99 = $4,998/mo (cost: $4,020/mo)
VIP: 100 users √ó $49.99 = $4,999/mo (cost: $3,240/mo)

Total revenue: $13,993/mo
Total cost: $8,439/mo
Profit: $5,554/mo
Margin: 40% ‚úÖ
```

**–í—ã–≤–æ–¥:** –ü—Ä–∏ –ª—é–±–æ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å **40%+** ‚úÖ

---

## ‚ö†Ô∏è –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

### –†–∏—Å–∫ 1: –ù–∏–∑–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Å–∏—è trial ‚Üí paid (< 10%)
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –£–ª—É—á—à–∏—Ç—å onboarding (–ø–æ–∫–∞–∑–∞—Ç—å killer features)
- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –ê/–ë —Ç–µ—Å—Ç—ã —Å–∫–∏–¥–æ–∫ (-20%, -30%, -40%)
- Gamification (–¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è, —Å—Ç—Ä–∏–∫–∏)

### –†–∏—Å–∫ 2: –í—ã—Å–æ–∫–∏–π usage —É VIP users (> 80%)
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- VIP –ª–∏–º–∏—Ç 100 ‚Üí 80 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å
- –ú—è–≥–∫–∏–π throttling (–∑–∞–¥–µ—Ä–∂–∫–∞ 1-2 —Å–µ–∫ –ø–æ—Å–ª–µ 80 –∑–∞–ø—Ä–æ—Å–æ–≤)
- –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å enterprise –ø–ª–∞–Ω ($99/–º–µ—Å, 200 –∑–∞–ø—Ä–æ—Å–æ–≤)

### –†–∏—Å–∫ 3: –ù–µ–≥–∞—Ç–∏–≤ –æ—Ç —É—Ä–µ–∑–∞–Ω–∏—è FREE
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –§–æ–∫—É—Å –Ω–∞ 7-day Premium trial (–∞ –Ω–µ –Ω–∞ FREE)
- "Try before you buy" —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
- FREE –∫–∞–∫ "–¥–µ–º–æ", –∞ –Ω–µ –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–¥—É–∫—Ç

### –†–∏—Å–∫ 4: –û—Ç—Ç–æ–∫ BASIC ‚Üí FREE
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- Loyalty bonuses (+5 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫–∞–∂–¥—ã–π 3-–π –º–µ—Å—è—Ü)
- Referral bonuses (–ø—Ä–∏–≤–µ–ª –¥—Ä—É–≥–∞ ‚Üí +10 –∑–∞–ø—Ä–æ—Å–æ–≤)
- –ì–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è (achievements unlock extra requests)

---

## üéâ –ò—Ç–æ–≥–æ

### –ì–ª–∞–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
1. ‚úÖ FREE: 5 ‚Üí **1 –∑–∞–ø—Ä–æ—Å/–¥–µ–Ω—å** (+ —É—Ä–µ–∑–∞–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª)
2. ‚úÖ **7-day Premium trial** –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. ‚úÖ –û—Ç–¥–µ–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã: **text / charts / vision**
4. ‚úÖ DeepSeek –¥–ª—è FREE/BASIC (–¥–µ—à–µ–≤–ª–µ –≤ 5x)
5. ‚úÖ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –±–æ–Ω—É—Å—ã **—É—Ä–µ–∑–∞–Ω—ã –≤ 3 —Ä–∞–∑–∞**
6. ‚úÖ Post-trial notification —Å **-20% —Å–∫–∏–¥–∫–æ–π** (48—á)
7. ‚úÖ –¶–µ–Ω—ã: BASIC $9.99, PREMIUM $24.99, VIP $49.99

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- üéØ **–ú–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å: 40-50%** (–±—ã–ª–æ: -20%)
- üìà **ARPU: $15-20** (—Ü–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞)
- üí∞ **Break-even: ~500 users** (20% –∫–æ–Ω–≤–µ—Ä—Å–∏—è)
- üöÄ **Scalable**: —ç–∫–æ–Ω–æ–º–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç 100 –¥–æ 100k –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

**Status:** ‚úÖ Ready for implementation
**Next steps:**
1. Database migration (add trial fields + request types)
2. Update middleware (separate text/chart/vision limits)
3. Create trial service + cron jobs
4. Update /start handler (highlight 7-day trial)
5. Implement post-trial notifications
6. Add Mini App checkout integration
7. Update localization (ru/en)
